!function(f){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=f();else if("function"==typeof define&&define.amd)define([],f);else{var g;g="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,g.ray=f()}}(function(){return function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a="function"==typeof require&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}for(var i="function"==typeof require&&require,o=0;o<r.length;o++)s(r[o]);return s}({1:[function(_dereq_,module,exports){"use strict";function EE(fn,context,once){this.fn=fn,this.context=context,this.once=once||!1}function EventEmitter(){}var has=Object.prototype.hasOwnProperty,prefix="function"!=typeof Object.create&&"~";EventEmitter.prototype._events=void 0,EventEmitter.prototype.eventNames=function(){var name,events=this._events,names=[];if(!events)return names;for(name in events)has.call(events,name)&&names.push(prefix?name.slice(1):name);return Object.getOwnPropertySymbols?names.concat(Object.getOwnPropertySymbols(events)):names},EventEmitter.prototype.listeners=function(event,exists){var evt=prefix?prefix+event:event,available=this._events&&this._events[evt];if(exists)return!!available;if(!available)return[];if(available.fn)return[available.fn];for(var i=0,l=available.length,ee=new Array(l);i<l;i++)ee[i]=available[i].fn;return ee},EventEmitter.prototype.emit=function(event,a1,a2,a3,a4,a5){var evt=prefix?prefix+event:event;if(!this._events||!this._events[evt])return!1;var args,i,listeners=this._events[evt],len=arguments.length;if("function"==typeof listeners.fn){switch(listeners.once&&this.removeListener(event,listeners.fn,void 0,!0),len){case 1:return listeners.fn.call(listeners.context),!0;case 2:return listeners.fn.call(listeners.context,a1),!0;case 3:return listeners.fn.call(listeners.context,a1,a2),!0;case 4:return listeners.fn.call(listeners.context,a1,a2,a3),!0;case 5:return listeners.fn.call(listeners.context,a1,a2,a3,a4),!0;case 6:return listeners.fn.call(listeners.context,a1,a2,a3,a4,a5),!0}for(i=1,args=new Array(len-1);i<len;i++)args[i-1]=arguments[i];listeners.fn.apply(listeners.context,args)}else{var j,length=listeners.length;for(i=0;i<length;i++)switch(listeners[i].once&&this.removeListener(event,listeners[i].fn,void 0,!0),len){case 1:listeners[i].fn.call(listeners[i].context);break;case 2:listeners[i].fn.call(listeners[i].context,a1);break;case 3:listeners[i].fn.call(listeners[i].context,a1,a2);break;default:if(!args)for(j=1,args=new Array(len-1);j<len;j++)args[j-1]=arguments[j];listeners[i].fn.apply(listeners[i].context,args)}}return!0},EventEmitter.prototype.on=function(event,fn,context){var listener=new EE(fn,context||this),evt=prefix?prefix+event:event;return this._events||(this._events=prefix?{}:Object.create(null)),this._events[evt]?this._events[evt].fn?this._events[evt]=[this._events[evt],listener]:this._events[evt].push(listener):this._events[evt]=listener,this},EventEmitter.prototype.once=function(event,fn,context){var listener=new EE(fn,context||this,(!0)),evt=prefix?prefix+event:event;return this._events||(this._events=prefix?{}:Object.create(null)),this._events[evt]?this._events[evt].fn?this._events[evt]=[this._events[evt],listener]:this._events[evt].push(listener):this._events[evt]=listener,this},EventEmitter.prototype.removeListener=function(event,fn,context,once){var evt=prefix?prefix+event:event;if(!this._events||!this._events[evt])return this;var listeners=this._events[evt],events=[];if(fn)if(listeners.fn)(listeners.fn!==fn||once&&!listeners.once||context&&listeners.context!==context)&&events.push(listeners);else for(var i=0,length=listeners.length;i<length;i++)(listeners[i].fn!==fn||once&&!listeners[i].once||context&&listeners[i].context!==context)&&events.push(listeners[i]);return events.length?this._events[evt]=1===events.length?events[0]:events:delete this._events[evt],this},EventEmitter.prototype.removeAllListeners=function(event){return this._events?(event?delete this._events[prefix?prefix+event:event]:this._events=prefix?{}:Object.create(null),this):this},EventEmitter.prototype.off=EventEmitter.prototype.removeListener,EventEmitter.prototype.addListener=EventEmitter.prototype.on,EventEmitter.prototype.setMaxListeners=function(){return this},EventEmitter.prefixed=prefix,"undefined"!=typeof module&&(module.exports=EventEmitter)},{}],2:[function(_dereq_,module,exports){"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),HEAD_ELBOW_OFFSET=new THREE.Vector3(.155,(-.465),(-.15)),ELBOW_WRIST_OFFSET=new THREE.Vector3(0,0,(-.25)),WRIST_CONTROLLER_OFFSET=new THREE.Vector3(0,0,.05),ARM_EXTENSION_OFFSET=new THREE.Vector3((-.08),.14,.08),ELBOW_BEND_RATIO=.4,EXTENSION_RATIO_WEIGHT=.4,MIN_ANGULAR_SPEED=.61,DaydreamArmModel=function(){function DaydreamArmModel(){_classCallCheck(this,DaydreamArmModel),this.isLeftHanded=!1,this.controllerQ=new THREE.Quaternion,this.lastControllerQ=new THREE.Quaternion,this.headQ=new THREE.Quaternion,this.headPos=new THREE.Vector3,this.elbowPos=new THREE.Vector3,this.wristPos=new THREE.Vector3,this.time=null,this.lastTime=null,this.rootQ=new THREE.Quaternion,this.pose={orientation:new THREE.Quaternion,position:new THREE.Vector3}}return _createClass(DaydreamArmModel,[{key:"setControllerOrientation",value:function(quaternion){this.lastControllerQ.copy(this.controllerQ),this.controllerQ.copy(quaternion)}},{key:"setHeadOrientation",value:function(quaternion){this.headQ.copy(quaternion)}},{key:"setHeadPosition",value:function(position){this.headPos.copy(position)}},{key:"setLeftHanded",value:function(isLeftHanded){this.isLeftHanded=isLeftHanded}},{key:"update",value:function(){this.time=performance.now();var headYawQ=this.getHeadYawOrientation_(),timeDelta=(this.time-this.lastTime)/1e3,angleDelta=this.quatAngle_(this.lastControllerQ,this.controllerQ),controllerAngularSpeed=angleDelta/timeDelta;controllerAngularSpeed>MIN_ANGULAR_SPEED?this.rootQ.slerp(headYawQ,angleDelta/10):this.rootQ.copy(headYawQ);var controllerEuler=(new THREE.Euler).setFromQuaternion(this.controllerQ,"YXZ"),controllerXDeg=THREE.Math.radToDeg(controllerEuler.x),extensionRatio=this.clamp_((controllerXDeg-11)/39,0,1),controllerCameraQ=this.rootQ.clone().inverse();controllerCameraQ.multiply(this.controllerQ);var elbowPos=this.elbowPos;elbowPos.copy(this.headPos).add(HEAD_ELBOW_OFFSET);var elbowOffset=(new THREE.Vector3).copy(ARM_EXTENSION_OFFSET);elbowOffset.multiplyScalar(extensionRatio),elbowPos.add(elbowOffset);var totalAngle=this.quatAngle_(controllerCameraQ,new THREE.Quaternion),totalAngleDeg=THREE.Math.radToDeg(totalAngle),lerpSuppression=1-Math.pow(totalAngleDeg/180,4),elbowRatio=ELBOW_BEND_RATIO,wristRatio=1-ELBOW_BEND_RATIO,lerpValue=lerpSuppression*(elbowRatio+wristRatio*extensionRatio*EXTENSION_RATIO_WEIGHT),wristQ=(new THREE.Quaternion).slerp(controllerCameraQ,lerpValue),invWristQ=wristQ.inverse(),elbowQ=controllerCameraQ.clone().multiply(invWristQ),wristPos=this.wristPos;wristPos.copy(WRIST_CONTROLLER_OFFSET),wristPos.applyQuaternion(wristQ),wristPos.add(ELBOW_WRIST_OFFSET),wristPos.applyQuaternion(elbowQ),wristPos.add(this.elbowPos);var offset=(new THREE.Vector3).copy(ARM_EXTENSION_OFFSET);offset.multiplyScalar(extensionRatio);var position=(new THREE.Vector3).copy(this.wristPos);position.add(offset),position.applyQuaternion(this.rootQ);var orientation=(new THREE.Quaternion).copy(this.controllerQ);this.pose.orientation.copy(orientation),this.pose.position.copy(position),this.lastTime=this.time}},{key:"getPose",value:function(){return this.pose}},{key:"getForearmLength",value:function(){return ELBOW_WRIST_OFFSET.length()}},{key:"getElbowPosition",value:function(){var out=this.elbowPos.clone();return out.applyQuaternion(this.rootQ)}},{key:"getWristPosition",value:function(){var out=this.wristPos.clone();return out.applyQuaternion(this.rootQ)}},{key:"getHeadYawOrientation_",value:function(){var headEuler=(new THREE.Euler).setFromQuaternion(this.headQ,"YXZ");headEuler.x=0,headEuler.z=0;var destinationQ=(new THREE.Quaternion).setFromEuler(headEuler);return destinationQ}},{key:"clamp_",value:function(value,min,max){return Math.min(Math.max(value,min),max)}},{key:"quatAngle_",value:function(q1,q2){var vec1=new THREE.Vector3(0,0,(-1)),vec2=new THREE.Vector3(0,0,(-1));return vec1.applyQuaternion(q1),vec2.applyQuaternion(q2),vec1.angleTo(vec2)}}]),DaydreamArmModel}();exports.default=DaydreamArmModel},{}],3:[function(_dereq_,module,exports){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}Object.defineProperty(exports,"__esModule",{value:!0});var _rayInput=_dereq_("./ray-input"),_rayInput2=_interopRequireDefault(_rayInput);exports.default=_rayInput2.default},{"./ray-input":5}],4:[function(_dereq_,module,exports){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_eventemitter=_dereq_("eventemitter3"),_eventemitter2=_interopRequireDefault(_eventemitter),_rayInteractionModes=_dereq_("./ray-interaction-modes"),_rayInteractionModes2=_interopRequireDefault(_rayInteractionModes),_util=_dereq_("./util"),DRAG_DISTANCE_PX=10,RayController=function(_EventEmitter){function RayController(renderer){_classCallCheck(this,RayController);var _this=_possibleConstructorReturn(this,(RayController.__proto__||Object.getPrototypeOf(RayController)).call(this));return _this.renderer=renderer,_this.availableInteractions={},window.addEventListener("mousedown",_this.onMouseDown_.bind(_this)),window.addEventListener("mousemove",_this.onMouseMove_.bind(_this)),window.addEventListener("mouseup",_this.onMouseUp_.bind(_this)),window.addEventListener("touchstart",_this.onTouchStart_.bind(_this)),window.addEventListener("touchmove",_this.onTouchMove_.bind(_this)),window.addEventListener("touchend",_this.onTouchEnd_.bind(_this)),_this.pointer=new THREE.Vector2,_this.lastPointer=new THREE.Vector2,_this.pointerNdc=new THREE.Vector2,_this.dragDistance=0,_this.isDragging=!1,_this.gamepad=null,window.addEventListener("gamepadconnected",_this.onGamepadConnected_.bind(_this)),navigator.getVRDisplays().then(function(displays){this.vrDisplay=displays[0]}.bind(_this)),window.addEventListener("vrdisplaypresentchange",_this.onVRDisplayPresentChange_.bind(_this)),_this}return _inherits(RayController,_EventEmitter),_createClass(RayController,[{key:"getInteractionMode",value:function(){var gamepad=this.getVRGamepad_();return gamepad?"Daydream Controller"==gamepad.id?_rayInteractionModes2.default.DAYDREAM:"Vive Controller"==gamepad.id?_rayInteractionModes2.default.VIVE:_rayInteractionModes2.default.TOUCH:(0,_util.isMobile)()?this.vrDisplay&&this.vrDisplay.isPresenting?_rayInteractionModes2.default.CARDBOARD:_rayInteractionModes2.default.TOUCH:_rayInteractionModes2.default.MOUSE}},{key:"getGamepadPose",value:function(){var gamepad=this.getVRGamepad_();return gamepad.pose}},{key:"setSize",value:function(size){this.size=size}},{key:"update",value:function(){if(this.getInteractionMode()==_rayInteractionModes2.default.DAYDREAM){var isGamepadPressed=this.getGamepadButtonPressed_();isGamepadPressed&&!this.wasGamepadPressed&&this.emit("action"),!isGamepadPressed&&this.wasGamepadPressed&&this.emit("release"),this.wasGamepadPressed=isGamepadPressed}}},{key:"getGamepadButtonPressed_",value:function(){var gamepad=this.getVRGamepad_();if(!gamepad)return!1;for(var j=0;j<gamepad.buttons.length;++j)if(gamepad.buttons[j].pressed)return!0;return!1}},{key:"onMouseDown_",value:function(e){this.startDragging_(e),this.emit("action")}},{key:"onMouseMove_",value:function(e){this.updatePointer_(e),this.updateDragDistance_(),this.emit("pointermove",this.pointerNdc)}},{key:"onMouseUp_",value:function(e){this.endDragging_()}},{key:"onTouchStart_",value:function(e){var t=e.touches[0];this.startDragging_(t),this.updateTouchPointer_(e),this.emit("pointermove",this.pointerNdc),this.emit("action")}},{key:"onTouchMove_",value:function(e){this.updateTouchPointer_(e),this.updateDragDistance_()}},{key:"onTouchEnd_",value:function(e){this.endDragging_()}},{key:"updateTouchPointer_",value:function(e){if(0===e.touches.length)return void console.warn("Received touch event with no touches.");var t=e.touches[0];this.updatePointer_(t)}},{key:"updatePointer_",value:function(e){this.pointer.set(e.clientX,e.clientY),this.pointerNdc.x=e.clientX/this.size.width*2-1,this.pointerNdc.y=2*-(e.clientY/this.size.height)+1}},{key:"updateDragDistance_",value:function(){if(this.isDragging){var distance=this.lastPointer.sub(this.pointer).length();this.dragDistance+=distance,this.lastPointer.copy(this.pointer),console.log("dragDistance",this.dragDistance),this.dragDistance>DRAG_DISTANCE_PX&&(this.emit("cancel"),this.isDragging=!1)}}},{key:"startDragging_",value:function(e){this.isDragging=!0,this.lastPointer.set(e.clientX,e.clientY)}},{key:"endDragging_",value:function(){this.dragDistance<DRAG_DISTANCE_PX&&this.emit("release"),this.dragDistance=0,this.isDragging=!1}},{key:"onGamepadConnected_",value:function(e){navigator.getGamepads()[e.gamepad.index]}},{key:"onVRDisplayPresentChange_",value:function(e){console.log("onVRDisplayPresentChange_",e)}},{key:"getVRGamepad_",value:function(){for(var gamepads=navigator.getGamepads(),i=0;i<gamepads.length;++i){var gamepad=gamepads[i];if(gamepad&&gamepad.pose)return gamepad}return null}}]),RayController}(_eventemitter2.default);exports.default=RayController},{"./ray-interaction-modes":6,"./util":8,eventemitter3:1}],5:[function(_dereq_,module,exports){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_daydreamArmModel=_dereq_("./daydream-arm-model"),_daydreamArmModel2=_interopRequireDefault(_daydreamArmModel),_eventemitter=_dereq_("eventemitter3"),_eventemitter2=_interopRequireDefault(_eventemitter),_rayRenderer=_dereq_("./ray-renderer"),_rayRenderer2=_interopRequireDefault(_rayRenderer),_rayController=_dereq_("./ray-controller"),_rayController2=_interopRequireDefault(_rayController),_rayInteractionModes=_dereq_("./ray-interaction-modes"),_rayInteractionModes2=_interopRequireDefault(_rayInteractionModes),RayInput=function(_EventEmitter){function RayInput(camera){_classCallCheck(this,RayInput);var _this=_possibleConstructorReturn(this,(RayInput.__proto__||Object.getPrototypeOf(RayInput)).call(this));return _this.camera=camera,_this.renderer=new _rayRenderer2.default(camera),_this.controller=new _rayController2.default,_this.armModel=new _daydreamArmModel2.default,_this.controller.on("action",_this.onAction_.bind(_this)),_this.controller.on("release",_this.onRelease_.bind(_this)),_this.controller.on("cancel",_this.onCancel_.bind(_this)),_this.controller.on("pointermove",_this.onPointerMove_.bind(_this)),_this.renderer.on("select",function(mesh){_this.emit("select",mesh)}),_this.renderer.on("deselect",function(mesh){_this.emit("deselect",mesh)}),_this.pointerNdc=new THREE.Vector2(1,1),_this.handlers={},_this}return _inherits(RayInput,_EventEmitter),_createClass(RayInput,[{key:"add",value:function(object,handlers){this.renderer.add(object,handlers),this.handlers[object.id]=handlers}},{key:"remove",value:function(object){this.renderer.remove(object),delete this.handlers[object.id]}},{key:"update",value:function(){var lookAt=new THREE.Vector3(0,0,(-1));lookAt.applyQuaternion(this.camera.quaternion);var mode=this.controller.getInteractionMode();switch(mode){case _rayInteractionModes2.default.MOUSE:this.renderer.setPointer(this.pointerNdc),this.renderer.setRayVisibility(!0);break;case _rayInteractionModes2.default.TOUCH:this.renderer.setPointer(this.pointerNdc),this.renderer.setReticleVisibility(!1);break;case _rayInteractionModes2.default.CARDBOARD:this.renderer.setPosition(this.camera.position),this.renderer.setOrientation(this.camera.quaternion);break;case _rayInteractionModes2.default.DAYDREAM:var pose=this.controller.getGamepadPose(),controllerOrientation=(new THREE.Quaternion).fromArray(pose.orientation);this.armModel.setHeadOrientation(this.camera.quaternion),this.armModel.setHeadPosition(this.camera.position),this.armModel.setControllerOrientation(controllerOrientation),this.armModel.update();var modelPose=this.armModel.getPose();this.renderer.setPosition(modelPose.position),this.renderer.setOrientation(modelPose.orientation),this.renderer.setRayVisibility(!0);break;case _rayInteractionModes2.default.VIVE:}this.renderer.update(),this.controller.update()}},{key:"setSize",value:function(size){this.controller.setSize(size)}},{key:"getMesh",value:function(){return this.renderer.getReticleRayMesh()}},{key:"getOrigin",value:function(){return this.renderer.getOrigin()}},{key:"getDirection",value:function(){return this.renderer.getDirection()}},{key:"getRightDirection",value:function(){var lookAt=new THREE.Vector3(0,0,(-1));return lookAt.applyQuaternion(this.camera.quaternion),(new THREE.Vector3).crossVectors(lookAt,this.camera.up)}},{key:"onAction_",value:function(e){console.log("onAction_"),this.fireActiveMeshEvent_("onAction");var mesh=this.renderer.getSelectedMesh();this.emit("action",mesh),this.renderer.setActive(!0)}},{key:"onRelease_",value:function(e){console.log("onRelease_"),this.fireActiveMeshEvent_("onRelease");var mesh=this.renderer.getSelectedMesh();this.emit("release",mesh),this.renderer.setActive(!1)}},{key:"onCancel_",value:function(e){console.log("onCancel_");var mesh=this.renderer.getSelectedMesh();this.emit("cancel",mesh)}},{key:"fireActiveMeshEvent_",value:function(eventName){var mesh=this.renderer.getSelectedMesh();if(mesh){var handlers=this.handlers[mesh.id];handlers&&handlers[eventName]&&handlers[eventName](mesh)}}},{key:"onPointerMove_",value:function(ndc){this.pointerNdc.copy(ndc)}}]),RayInput}(_eventemitter2.default);exports.default=RayInput},{"./daydream-arm-model":2,"./ray-controller":4,"./ray-interaction-modes":6,"./ray-renderer":7,eventemitter3:1}],6:[function(_dereq_,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var InteractionModes={MOUSE:1,TOUCH:2,CARDBOARD:3,DAYDREAM:4,VIVE:5};exports.default=InteractionModes},{}],7:[function(_dereq_,module,exports){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_eventemitter=_dereq_("eventemitter3"),_eventemitter2=_interopRequireDefault(_eventemitter),RETICLE_DISTANCE=3,INNER_RADIUS=.02,OUTER_RADIUS=.04,RAY_RADIUS=.02,RayRenderer=function(_EventEmitter){function RayRenderer(camera,opt_params){_classCallCheck(this,RayRenderer);var _this=_possibleConstructorReturn(this,(RayRenderer.__proto__||Object.getPrototypeOf(RayRenderer)).call(this));_this.camera=camera;return _this.meshes={},_this.selected={},_this.handlers={},_this.raycaster=new THREE.Raycaster,_this.position=new THREE.Vector3,_this.orientation=new THREE.Quaternion,_this.root=new THREE.Object3D,_this.reticle=_this.createReticle_(),_this.root.add(_this.reticle),_this.ray=_this.createRay_(),_this.root.add(_this.ray),_this.reticleDistance=RETICLE_DISTANCE,_this}return _inherits(RayRenderer,_EventEmitter),_createClass(RayRenderer,[{key:"add",value:function(object,opt_handlers){this.meshes[object.id]=object;var handlers=opt_handlers||{};this.handlers[object.id]=handlers}},{key:"remove",value:function(object){var id=object.id;if(this.meshes[id]||(delete this.meshes[id],delete this.handlers[id]),this.selected[id]){var handlers=this.handlers[id];handlers.onDeselect&&handlers.onDeselect(object),delete this.selected[object.id]}}},{key:"update",value:function(){for(var id in this.meshes){var mesh=this.meshes[id],handlers=this.handlers[id],intersects=this.raycaster.intersectObject(mesh,!0),isIntersected=intersects.length>0,isSelected=this.selected[id];isIntersected&&!isSelected&&(this.selected[id]=!0,handlers.onSelect&&handlers.onSelect(mesh),this.emit("select",mesh)),!isIntersected&&isSelected&&(delete this.selected[id],handlers.onDeselect&&handlers.onDeselect(mesh),this.moveReticle_(null),this.emit("deselect",mesh)),isIntersected&&this.moveReticle_(intersects)}}},{key:"setPosition",value:function(vector){this.position.copy(vector),this.raycaster.ray.origin.copy(vector),this.updateRaycaster_()}},{key:"getOrigin",value:function(){return this.raycaster.ray.origin}},{key:"setOrientation",value:function(quaternion){this.orientation.copy(quaternion);var pointAt=new THREE.Vector3(0,0,(-1)).applyQuaternion(quaternion);this.raycaster.ray.direction.copy(pointAt),this.updateRaycaster_()}},{key:"getDirection",value:function(){return this.raycaster.ray.direction}},{key:"setPointer",value:function(vector){this.raycaster.setFromCamera(vector,this.camera),this.updateRaycaster_()}},{key:"getReticleRayMesh",value:function(){return this.root}},{key:"getSelectedMesh",value:function(){var count=0,mesh=null;for(var id in this.selected)count+=1,mesh=this.meshes[id];return count>1&&console.warn("More than one mesh selected."),mesh}},{key:"setReticleVisibility",value:function(isVisible){this.reticle.visible=isVisible}},{key:"setRayVisibility",value:function(isVisible){this.ray.visible=isVisible}},{key:"setActive",value:function(isActive){}},{key:"updateRaycaster_",value:function(){var ray=this.raycaster.ray,position=this.reticle.position;position.copy(ray.direction),position.multiplyScalar(this.reticleDistance),position.add(ray.origin);var delta=(new THREE.Vector3).copy(ray.direction);delta.multiplyScalar(this.reticleDistance),this.ray.scale.y=delta.length();var arrow=new THREE.ArrowHelper(ray.direction,ray.origin);this.ray.rotation.copy(arrow.rotation),this.ray.position.addVectors(ray.origin,delta.multiplyScalar(.5))}},{key:"createReticle_",value:function(){var innerGeometry=new THREE.SphereGeometry(INNER_RADIUS,32,32),innerMaterial=new THREE.MeshBasicMaterial({color:16777215,transparent:!0,opacity:.9}),inner=new THREE.Mesh(innerGeometry,innerMaterial),outerGeometry=new THREE.SphereGeometry(OUTER_RADIUS,32,32),outerMaterial=new THREE.MeshBasicMaterial({color:3355443,transparent:!0,opacity:.3}),outer=new THREE.Mesh(outerGeometry,outerMaterial),reticle=new THREE.Group;return reticle.add(inner),reticle.add(outer),reticle}},{key:"moveReticle_",value:function(intersections){var distance=RETICLE_DISTANCE;if(intersections){var inter=intersections[0];distance=inter.distance}this.reticleDistance=distance,this.updateRaycaster_()}},{key:"createRay_",value:function(){var geometry=new THREE.CylinderGeometry(RAY_RADIUS,RAY_RADIUS,1,32),material=new THREE.MeshBasicMaterial({map:THREE.ImageUtils.loadTexture("./static/gradient.png"),transparent:!0,opacity:.3}),mesh=new THREE.Mesh(geometry,material);return mesh}}]),RayRenderer}(_eventemitter2.default);exports.default=RayRenderer},{eventemitter3:1}],8:[function(_dereq_,module,exports){"use strict";function isMobile(){var check=!1;return function(a){(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(a)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(a.substr(0,4)))&&(check=!0)}(navigator.userAgent||navigator.vendor||window.opera),check}Object.defineProperty(exports,"__esModule",{value:!0}),exports.isMobile=isMobile},{}]},{},[3])(3)});
